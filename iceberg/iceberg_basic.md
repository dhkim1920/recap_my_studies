
# Apache Iceberg 개요 및 특징

## 개요
Apache Iceberg는 대규모 데이터 레이크에서 **신뢰성과 성능**을 갖춘 테이블 포맷을 제공하기 위해 개발된 오픈소스 프로젝트이다.

- 분산 파일 시스템(HDFS, S3 등) 위에서 동작
  - catalog warehouse로 설정할 수 있다.
- Hive와 달리 스냅샷, 트랜잭션, 스키마/파티션 진화 등을 지원
- SQL 엔진(Flink, Spark, Trino 등)과 자연스럽게 통합
- 페타바이트급 데이터를 위한 설계

---

## 왜 사용하는가?

| 기존 시스템 문제 | Iceberg로 해결 |
|------------------|----------------|
| Hive는 ACID 트랜잭션 미지원 | 완전한 트랜잭션 지원 |
| 파티션 변경/스키마 변경 어려움 | 유연한 진화 기능 |
| 과거 데이터 조회 불가 | 스냅샷 기반 시간 여행/롤백 가능 |
| 병렬성/동시성 문제 | MVCC로 안정적인 병렬 처리 |
| 쿼리 성능 저하 | 숨겨진 파티셔닝으로 자동 최적화 |

--- 

## Apache Iceberg 주요 기능 정리

### 1. SQL 친화적 사용
- Iceberg는 테이블처럼 동작하며, SQL만으로 대부분의 작업 수행 가능
- Spark, Trino, Flink, Hive 등에서 표준 SQL로 접근 가능
- 별도 DSL 학습 없이 분석가, 개발자 모두 활용 가능

### 2. ACID 트랜잭션 지원
- 병렬 쓰기, 동시 읽기/쓰기 환경에서 데이터 손상 없이 일관성 보장
- Spark 등 분산 환경에서도 안정적 트랜잭션 처리

### 3. 스키마 및 파티션 진화
- 열 추가/삭제/이름 변경 등 기존 데이터 수정 없이 수행 가능
- 파티션 구조도 동적으로 변경 가능 → 유연성 및 확장성 확보

### 4. 시간 이동(Time Travel) 및 버전 관리
- 과거 스냅샷 또는 시점 기준으로 데이터 조회 가능
- 실수 복구, 리포트 재현, 변경 이력 분석에 활용
`VERSION AS OF`, `TIMESTAMP AS OF`

### 5. 증분 처리 (Incremental Processing)
- 특정 시점 이후 변경된 데이터만 추출 가능
- CDC 방식으로 동작 → 대규모 데이터 환경에서 효율적 ETL

### 6. 다양한 쿼리 엔진과 호환
- Spark, Flink, Trino, Hive 등에서 동일한 Iceberg 테이블 공유 가능
- 포맷 독립적 구조 → 특정 엔진/포맷에 종속되지 않음

### 7. 메타데이터 최적화
- 경량 메타데이터 파일로 수천~수백만 개의 파일 관리 가능
- 빠른 스냅샷 탐색, 병합, 정리 처리 지원

### 8. 클라우드 및 오브젝트 스토리지 친화
- HDFS 외에도 S3, GCS, Azure Blob 등 다양한 스토리지에서 안정적 운영
- 분산/클라우드 환경에서의 신뢰성과 확장성 보장

| **브랜치/태그 기반 스냅샷 관리** | Git처럼 브랜치를 나누어 실험적 변경 가능, 태그로 스냅샷 고정 및 복원 |
| **Partition Evolution** | 기존 데이터 유지하며 파티션 전략 변경 가능 (예: 날짜 → 날짜+지역) |
| **Hidden Partitioning** | 파티션 키 노출 없이도 성능 확보. 자동 파티션 프루닝 수행 |

### 9. 브랜치 및 태그 기반 스냅샷 관리
- Git처럼 스냅샷을 브랜치로 나누어 실험적 변경 가능
- 태그(Tag)를 지정해 특정 시점의 데이터를 고정, 손쉽게 복원 가능

### 10. Partition Evolution
- 기존 데이터에 영향을 주지 않으면서 파티션 전략 변경 가능
- 예: `partition by day` → `partition by day, region` 등으로 유연하게 확장

### 11. Hidden Partitioning
- 파티션 키를 명시하지 않아도 내부적으로 관리
- 쿼리 성능 저하 없이 자동 파티션 프루닝 수행
- 사용자는 SQL을 단순하게 유지하면서도 최적화된 쿼리 가능

---

## Apache Iceberg 주요 활용 사례

### 1. 레코드 단위 삭제 및 개인정보 보호 (GDPR/CCPA 대응)
- 특정 사용자의 데이터 삭제 요청에 따라 개별 레코드 안전하게 삭제 가능
- HDFS나 Parquet 단독 사용 시 어려운 작업을 Iceberg는 **ACID 기반으로 안정 처리**

### 2. 레코드 수준 업데이트가 필요한 테이블
- 반품, 정정, 상태 갱신 등이 발생하는 거래/이벤트 로그 처리에 적합
- 전체 파일 재작성 없이 **특정 행만 빠르게 업데이트 가능**

### 3. Slowly Changing Dimension (SCD) 테이블 처리
- 고객 정보, 주소, 연락처 등 불규칙하게 바뀌는 데이터를 추적 가능
- 스냅샷 + 타임트래블 기능으로 변화 이력 관리에 최적화

### 4. ACID 트랜잭션 기반 데이터 레이크
- 데이터 품질과 일관성이 중요한 DWH형 작업에 적합
- 여러 사용자/프로세스의 동시 접근 환경에서도 안전하게 동작

### 5. 과거 버전 조회(Time Travel) 및 분석
- 추세 분석, 리포트 재생산, 문제 발생 전 상태 복구 등에 활용
- 특정 시점으로 정확한 롤백 가능

### 6. 증분 로딩 및 CDC 처리
- 마지막 실행 이후 변경된 데이터만 필터링하여 로딩 가능
- 효율적인 ETL, 데이터 웨어하우스 갱신 작업에 적합

### 7. 멀티 엔진 접근을 지원하는 공유 테이블
- Spark, Flink, Trino 등 다양한 처리 엔진에서 공통 테이블 사용 가능
- 하나의 Iceberg 테이블을 다양한 워크플로우에서 공유하여 활용

