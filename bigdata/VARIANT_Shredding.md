## VARIANT Shredding

### VARIANT Shredding 이란?
**VARIANT Shredding**은 쉽게 말해 **"JSON 같은 복잡한 비정형 데이터를 저장할 때, 자주 쓰는 필드만 쏙쏙 뽑아서 마치 일반 테이블 컬럼 처럼 따로 저장하는 기술"**이다.

기존에 JSON 데이터를 다룰 때의 성능 병목을 해결하기 위해 Spark 4.1에서 도입된 핵심 최적화 기법입니다.

### 1. 왜 필요할까?

보통 JSON 데이터를 `JSON` 타입이나 단순 문자열로 저장하면, 특정 필드 하나만 보고 싶어도 **전체 JSON 덩어리를 다 읽어서 파싱**해야 한다. 따라서 데이터가 커질수록 I/O와 CPU 소모가 커진다.

### 2. Shredding의 동작 원리

'Shredding'은 '채를 썰다' 혹은 '조각내다'라는 뜻이다. 이름처럼 데이터를 분해해서 저장한다.

- **분해 저장:** JSON 내부의 데이터 중 자주 조회되는 필드(예: `user_id`, `price`)를 파악하여, 스토리지 레벨(Parquet 등)에서 별도의 하위 컬럼으로 물리적 분리 저장
- **하이브리드 구조:** * 자주 쓰는 값은 **컬럼형**으로 저장, 나머지 복잡하거나 가끔 쓰는 값은 **Blob** 형태로 유지
- **조회 시 최적화:** 사용자가 SQL로 `data:user_id`를 조회하면, 전체 JSON을 파싱하지 않고 미리 분리해둔 `user_id` 컬럼만 딱 읽는다.

### 3. 주요 특징 및 장점

| 구분 | 기존 JSON 처리 (String/Struct) | VARIANT Shredding |
| --- | --- | --- |
| **유연성** | Schema를 미리 정의해야 하거나 변경 시 복잡함 | Schema-on-read 지원 (비정형 그대로 저장 가능) |
| **읽기 성능** | 전체 파싱 필요 (느림) | 필요한 필드만 선택적 읽기 |
| **저장 효율** | 중복 데이터가 많음 | 컬럼형 압축 기술 적용 가능 (용량 절감) |
