# Kubernetes Sidecar Containers 

## 1. 개념

사이드카 컨테이너는 동일한 Pod 내에서 **기본 애플리케이션 컨테이너와 함께 실행되는 보조 컨테이너**이다. 메인 앱의 코드를 수정하지 않고도 로깅, 모니터링, 보안, 데이터 동기화 등의 기능을 추가할 때 사용된다.

## 2. 쿠버네티스의 구현 방식 (v1.29+ Stable)

최신 쿠버네티스에서는 사이드카를 **`initContainers`의 특별한 유형**으로 처리한다.

- **설정 방법:** `initContainers` 목록 내에 컨테이너를 정의하고, `restartPolicy: Always`를 설정하면 사이드카로 작동한다.
- **실행 시점:** 일반적인 초기화 컨테이너는 작업 완료 후 종료되지만, 사이드카 컨테이너는 파드가 실행되는 동안 **계속 유지**된다.

## 3. 주요 특징 및 작동 원리

- **시작 순서:** `initContainers` 리스트에 정의된 순서대로 시작된다. 사이드카가 실행 중(Running) 상태가 되면 다음 초기화 컨테이너나 메인 컨테이너가 시작된다.
- **종료 순서:** 메인 애플리케이션 컨테이너가 먼저 종료된 후, 사이드카가 종료된다. 이는 사이드카가 마지막 순간까지 앱의 로그 수집이나 정리를 돕도록 보장하기 위함
- **Job과의 호환성:** 쿠버네티스 Job에서 사이드카를 사용할 경우, 메인 작업이 끝나면 사이드카가 실행 중이더라도 Job은 '완료'된 것으로 간주 (과거에는 사이드카가 종료되지 않아 Job이 끝나지 않던 문제가 해결됨)

## 4. 왜 사용할까?

- **관심사 분리:** 비즈니스 로직과 부가 기능(Logging, Proxy 등)을 분리하여 관리
- **환경 일관성:** 여러 앱 컨테이너에서 동일한 사이드카 이미지(예: Fluentbit, Envoy)를 재사용 가능
- **독립적 제어:** 메인 컨테이너에 영향을 주지 않고 사이드카만 재시작하거나 업데이트할 수 있다.
