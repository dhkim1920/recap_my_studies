# Apache Kafka 기본 개념 정리  

## Apache Kafka란?  
Apache Kafka는 **분산 스트리밍 플랫폼**으로, 실시간 데이터 스트리밍을 처리하고 관리하는 오픈 소스 프레임워크  
대용량 데이터를 높은 처리 속도로 저장, 처리, 전송할 수 있도록 설계됨

## Kafka의 특징  
- **높은 처리량**: 초당 수백만 건의 메시지를 처리할 수 있는 고성능  
- **확장성**: 클러스터를 통해 쉽게 확장 가능  
- **내결함성**: 데이터 복제와 다중 브로커 구성을 통해 안정성 확보  
- **영구 저장**: 데이터를 디스크에 저장하여 장애 시에도 복구 가능  
- **실시간 데이터 처리**: 데이터 스트림을 실시간으로 수집, 처리  

## Kafka 아키텍처  

| 구성 요소        | 설명                                                       |
|---------------|------------------------------------------------------------|
| **Producer**   | 데이터를 Kafka로 전송하는 클라이언트                        |
| **Broker**     | Kafka 서버로, 데이터를 저장하고 관리                        |
| **Topic**      | 메시지를 저장하는 논리적 개념으로, 특정 주제의 데이터 스트림 |
| **Partition**  | 하나의 Topic을 여러 개로 나눠 병렬 처리 성능 향상             |
| **Consumer**   | Kafka에서 데이터를 읽어오는 클라이언트                      |
| **Consumer Group** | 여러 Consumer가 협력하여 메시지를 병렬로 처리              |
| **Zookeeper**  | 클러스터 메타데이터 관리 및 Broker의 상태 모니터링           |

## Kafka의 리더-팔로워 구조  
Kafka의 파티션은 하나의 리더(Leader)와 여러 개의 팔로워(Follower)로 구성됨  
리더가 파티션의 **읽기/쓰기 요청을 처리**하고, 팔로워는 리더의 데이터를 복제하여 **데이터 일관성**을 유지함  

### 리더-팔로워 동작 방식  
1. 파티션당 하나의 리더와 여러 팔로워가 존재  
2. Producer와 Consumer는 리더를 통해 데이터를 송수신  
3. 팔로워는 주기적으로 리더의 데이터를 복제하여 **동기화** 유지  
4. 리더 장애 발생 시, 팔로워 중 하나가 **새로운 리더로 승격**되어 역할을 이어감  

### 리더-팔로워 구조의 장점  
- **데이터 안정성**: 복제본을 통해 장애 발생 시에도 데이터 복구 가능  
- **고가용성**: 리더 장애 시 팔로워를 승격하여 서비스 중단 방지  
- **부하 분산**: 리더-팔로워 간 데이터 복제를 통해 읽기 작업을 여러 노드에서 수행 가능  

## Kafka 데이터 흐름  
1. **데이터 전송**: Producer가 데이터를 특정 Topic으로 전송  
2. **데이터 저장**: Topic이 여러 개의 Partition으로 나뉘어 데이터 분산 저장  
3. **리더-팔로워 처리**: 파티션의 리더가 데이터를 처리하고, 팔로워가 복제하여 일관성 유지  
4. **Broker 저장**: 각 Partition은 Broker에 저장되어 복제본으로 관리  
5. **데이터 소비**: Consumer가 리더로부터 데이터를 가져와 처리  
6. **오프셋 관리**: 각 Consumer는 데이터를 읽은 위치를 Offset으로 관리하여 중복 처리 방지  

## Kafka 파티션과 컨슈머 그룹 관계  

### 파티션 수 < 컨슈머 수  
- 일부 컨슈머가 할당되지 않아 유휴 상태 발생  
- 리소스 낭비 문제  
- 컨슈머 인스턴스를 늘려도 처리 성능이 향상되지 않음  

### 파티션 수 > 컨슈머 수  
- 하나의 컨슈머가 여러 파티션을 처리하여 부하 집중  
- 처리 속도 저하와 성능 불균형 문제  
- 특정 컨슈머에 과부하가 걸려 장애 발생 가능성 증가  

## 최적 설계 방안  
- 파티션 수를 컨슈머 수와 동일하게 설정하여 자원 활용 최적화  
- 확장 시 파티션 수와 컨슈머 수를 비례하여 증가  
- 컨슈머 수가 파티션 수를 초과하지 않도록 관리  
